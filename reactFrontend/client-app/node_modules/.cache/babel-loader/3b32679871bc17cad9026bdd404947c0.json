{"ast":null,"code":"import io from 'socket.io-client';\nimport Peer from 'peerjs';\n\nclass SocketConnection {\n  constructor(props) {\n    this.ENDPOINT = 'localhost:5000';\n    this.peer = new Peer();\n    this.socket = io(this.ENDPOINT);\n    this.roomId = props.roomId;\n    this.peer = new Peer();\n    this.socket = io(this.ENDPOINT);\n    console.log('inside the connection da ngotha :' + props.roomId);\n    this.socketEvent();\n    this.PeerEvent();\n  }\n\n  socketEvent() {\n    /*  this.socket.on('user-joined',(Id)=>{\r\n         \r\n          this.connectToUser(Id);\r\n          console.log(\"joined use:\"+Id);\r\n         \r\n          \r\n        \r\n      });\r\n        */\n  }\n\n  PeerEvent() {\n    this.peer.on('open', id => {\n      this.userId = id;\n      this.setlocalstream();\n      this.socket.emit('joining-room', this.roomId, id);\n      console.log('generated userId: ' + id);\n    });\n  }\n\n  newUserConnection(stream) {\n    this.socket.on('user-joined', Id => {\n      this.connectToUser(Id);\n      console.log(\"joined use:\" + Id);\n    });\n  }\n\n  connectToUser(Id) {\n    const call = this.peer.call(Id, this.localstream);\n    console.log('made call to ' + Id);\n    call.on('stream', externalstream => {\n      this.addstream(externalstream, this.userId);\n    });\n    call.on('close', () => {\n      var video = document.getElementById('Id');\n      video.remove();\n    });\n  }\n\n  setPeerListenres(stream) {\n    this.peer.on('call', call => {\n      call.answer(stream);\n      call.on('stream', externalstream => {\n        console.log('incoming stream');\n        this.addstream(externalstream, this.userId);\n      });\n    });\n  }\n\n  setlocalstream() {\n    this.getvideoaudio().then(stream => {\n      this.localstream = stream;\n      this.addstream(stream, this.userId);\n      this.setPeerListenres(stream);\n    }).catch(function (err) {\n      console.log(err.name + \": \" + err.message);\n    });\n  }\n\n  getvideoaudio() {\n    const myNavigator = navigator.mediaDevices.getUserMedia || navigator.mediaDevices.webkitGetUserMedia || navigator.mediaDevices.mozGetUserMedia || navigator.mediaDevices.msGetUserMedia;\n    return navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    });\n  }\n\n  addstream(stream, Id) {\n    const videogrid = document.getElementById('video-grid');\n    const videoContainer = document.createElement('div');\n    const video = document.createElement('video');\n    video.srcObject = stream; // this.videoContainer[createObj.id].stream;\n\n    video.id = Id;\n    video.autoplay = true;\n    if (this.userId === Id) video.muted = true;\n    videoContainer.appendChild(video);\n    videogrid.append(videoContainer);\n    console.log(\"done creating video :\" + Id);\n  }\n\n}\n\nexport function createSocketConnectionInstance(settings = {}) {\n  return new SocketConnection(settings);\n}","map":{"version":3,"sources":["E:/Microsoft ENgae/reactFrontend/client-app/src/components/Connection.js"],"names":["io","Peer","SocketConnection","constructor","props","ENDPOINT","peer","socket","roomId","console","log","socketEvent","PeerEvent","on","id","userId","setlocalstream","emit","newUserConnection","stream","Id","connectToUser","call","localstream","externalstream","addstream","video","document","getElementById","remove","setPeerListenres","answer","getvideoaudio","then","catch","err","name","message","myNavigator","navigator","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","audio","videogrid","videoContainer","createElement","srcObject","autoplay","muted","appendChild","append","createSocketConnectionInstance","settings"],"mappings":"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","sourcesContent":["import io from 'socket.io-client';\r\nimport Peer from 'peerjs';\r\n\r\n\r\nclass SocketConnection {\r\n    ENDPOINT='localhost:5000';\r\n    peer= new Peer();\r\n    socket=io(this.ENDPOINT);\r\n  \r\n    constructor(props)\r\n    {\r\n        this.roomId=props.roomId;\r\n        this.peer=new Peer();\r\n        this.socket=io(this.ENDPOINT);\r\n        console.log('inside the connection da ngotha :'+props.roomId);\r\n        this.socketEvent();\r\n        this.PeerEvent();\r\n        \r\n        \r\n    }\r\n\r\n   \r\n    socketEvent()\r\n    {\r\n        \r\n      /*  this.socket.on('user-joined',(Id)=>{\r\n           \r\n            this.connectToUser(Id);\r\n            console.log(\"joined use:\"+Id);\r\n           \r\n            \r\n          \r\n        });\r\n\r\n        */\r\n       \r\n    }\r\n    PeerEvent()\r\n    {\r\n        this.peer.on('open',(id) =>{\r\n            this.userId=id;\r\n            this.setlocalstream();\r\n            this.socket.emit('joining-room', this.roomId, id);\r\n           \r\n            console.log('generated userId: '+id);\r\n            \r\n       });\r\n       \r\n      \r\n        \r\n    }\r\n\r\n    newUserConnection(stream)\r\n    {\r\n        this.socket.on('user-joined',(Id)=>{\r\n           \r\n            this.connectToUser(Id);\r\n            console.log(\"joined use:\"+Id);\r\n           \r\n            \r\n          \r\n        });\r\n\r\n    }\r\n    connectToUser(Id)\r\n        {\r\n       \r\n            const call=this.peer.call(Id,this.localstream);\r\n            console.log('made call to '+ Id);\r\n            call.on('stream',(externalstream)=>{\r\n                this.addstream(externalstream,this.userId);\r\n            })\r\n           call.on('close',()=>{\r\n                var video=document.getElementById('Id');\r\n                video.remove();\r\n            })\r\n        }\r\n   \r\n    \r\n    setPeerListenres(stream)\r\n    {\r\n        this.peer.on('call', (call) =>{\r\n            call.answer(stream);\r\n            call.on('stream',(externalstream)=>{\r\n             console.log('incoming stream');\r\n                \r\n                this.addstream(externalstream,this.userId);\r\n            })\r\n           \r\n        })\r\n    }\r\n    setlocalstream()\r\n    { \r\n        \r\n       this.getvideoaudio().then((stream)=> {\r\n         this.localstream=stream;\r\n        this.addstream(stream,this.userId);\r\n        this.setPeerListenres(stream);\r\n      })\r\n      .catch(function(err) { console.log(err.name + \": \" + err.message); });\r\n     \r\n    }\r\n    getvideoaudio()\r\n    {\r\n        const myNavigator = navigator.mediaDevices.getUserMedia || navigator.mediaDevices.webkitGetUserMedia || navigator.mediaDevices.mozGetUserMedia || navigator.mediaDevices.msGetUserMedia;\r\n        return navigator.mediaDevices.getUserMedia({video:true, audio:true});\r\n    }\r\n    \r\n    addstream(stream,Id)\r\n   {\r\n       const videogrid=document.getElementById('video-grid');\r\n      \r\n       const videoContainer = document.createElement('div');\r\n       const video = document.createElement('video');\r\n       video.srcObject =stream;// this.videoContainer[createObj.id].stream;\r\n       video.id=Id;\r\n       video.autoplay = true;\r\n       if (this.userId === Id) video.muted = true;\r\n       videoContainer.appendChild(video)\r\n       videogrid.append(videoContainer);\r\n       console.log(\"done creating video :\"+Id);\r\n       \r\n   }\r\n   \r\n\r\n}\r\n\r\n\r\nexport function createSocketConnectionInstance(settings={}) {\r\n    return  new SocketConnection(settings);\r\n}"]},"metadata":{},"sourceType":"module"}