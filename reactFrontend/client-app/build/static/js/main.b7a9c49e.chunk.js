(this["webpackJsonpclient-app"]=this["webpackJsonpclient-app"]||[]).push([[0],{155:function(e,t,n){},188:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=188},190:function(e,t,n){},192:function(e,t,n){},195:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n.n(s),a=n(10),c=n.n(a),o=n(121),i=n(11),d=n(15),u=n(105),l=n.n(u),h=n(239),m=n(244),p=n(238),v=n(235),j=n(237),g=(n(155),n(246)),b=n(4),S=function(e){var t=Object(s.useState)(""),n=Object(d.a)(t,2),a=n[0],c=n[1];return Object(b.jsx)(r.a.Fragment,{children:Object(b.jsx)("div",{class:"outer",children:Object(b.jsx)("div",{class:"middle",children:Object(b.jsx)("div",{class:"inner",children:Object(b.jsx)(g.a,{boxShadow:3,children:Object(b.jsx)(v.a,{className:"center card",children:Object(b.jsxs)(j.a,{align:"center",children:[Object(b.jsx)("br",{}),Object(b.jsx)("br",{}),Object(b.jsxs)(p.a,{container:!0,spacing:2,children:[Object(b.jsxs)(p.a,{container:!0,item:!0,xs:6,direction:"column",children:[Object(b.jsx)("h3",{children:"Create new room"}),Object(b.jsxs)("div",{children:[" ",Object(b.jsx)(m.a,{variant:"outlined",color:"white",type:"text",value:a,inputProps:{style:{padding:7}},onChange:function(e){c(e.target.value)}})," "]}),Object(b.jsx)(g.a,{m:2,pt:3,children:Object(b.jsx)("div",{children:Object(b.jsx)(h.a,{variant:"contained",color:"primary",onClick:function(){l.a.get("https://engage-video-app.herokuapp.com/",{cors:{origin:"https://engage-video-app.herokuapp.com/",methods:["GET","POST"]}}).then((function(e){c(e.data.link)}))},style:{maxWidth:"200px",maxHeight:"30px",minWidth:"30px",minHeight:"10px"},children:" Create Room"})})})]}),Object(b.jsxs)(p.a,{container:!0,item:!0,xs:6,direction:"column",children:[Object(b.jsx)("h3",{children:"Join existing one by pasting the code !"}),Object(b.jsx)(g.a,{m:2,pt:6,children:Object(b.jsx)("div",{children:Object(b.jsx)(h.a,{variant:"contained",color:"primary",onClick:function(){a&&e.history.push("/".concat(a))},style:{maxWidth:"200px",maxHeight:"30px",minWidth:"30px",minHeight:"10px"},children:" Join Room"})})})]})]})]})})})})})})})},f=n(110),O=n(111),k=n(112),x=n.n(k),y=n(113),C=n.n(y),w=function(){function e(t){Object(f.a)(this,e),this.ENDPOINT="https://engage-video-app.herokuapp.com/",this.peers={},this.videoContainer={},this.currentStream=null,this.mediaRecorder=null,this.screenShareStatus=!0,this.screenPresenter=!1,this.currentScreenShareID=null,this.recordedChunks=[],this.updatevalue=t.updatevalue,this.roomId=t.roomId,this.peer=new C.a,this.socket=x()(this.ENDPOINT),console.log("inside the connection :"+t.roomId),this.socketEvent(),this.PeerEvent(),document.getElementById("screen-share").style.display="none"}return Object(O.a)(e,[{key:"socketEvent",value:function(){var e=this;this.socket.on("screen-share",(function(t){console.log("screen-share view for:",t),e.currentScreenShareID=t,e.screenShareStatus=!e.screenShareStatus,e.updatevalue("screenShareStatus",e.screenShareStatus),e.screenShareView(t,e.videoContainer[t])})),this.socket.on("screen-share-newUser",(function(t,n){n===e.userId&&(e.currentScreenShareID=t,e.screenShareStatus=!e.screenShareStatus,e.updatevalue("screenShareStatus",e.screenShareStatus),console.log("replace video ID for new user",t),setTimeout((function(){e.videoContainer[t]&&e.screenShareView(t,e.videoContainer[t])}),1e3))})),this.socket.on("normal-view",(function(t){console.log("REvert view for:",t),e.screenShareStatus=!e.screenShareStatus,e.updatevalue("screenShareStatus",e.screenShareStatus),e.currentScreenShareID=null,e.screenShareRevert(t)})),this.socket.on("user-left",(function(t){e.currentScreenShareID===t&&(e.screenShareStatus=!e.screenShareStatus,e.updatevalue("screenShareStatus",e.screenShareStatus),e.currentScreenShareID=null,e.screenShareRevert(t)),e.removeuser(t)})),this.socket.on("new-message",(function(t,n){e.updatevalue("Incomingmessage",{userName:t,messageBody:n})})),this.socket.on("newuserName",(function(t){e.updatevalue("newuserName",{userName:t,messageBody:" joined chat"})})),this.socket.on("userleftchat",(function(t){e.updatevalue("newuserName",{userName:t,messageBody:" left chat"})}))}},{key:"PeerEvent",value:function(){var e=this;this.peer.on("open",(function(t){e.userId=t,console.log("generated userId: "+t),e.setlocalstream(),console.log("emitting joining room request"),setTimeout((function(){e.socket.emit("joining-room",e.roomId,t)}),1500)})),this.peer.on("error",(function(t){console.log("reconnecting to peer",t),alert("Check your internet connection and re-try"),e.peer.reconnect()}))}},{key:"newUserConnection",value:function(){var e=this;this.socket.on("user-joined",(function(t){console.log("joined use:"+t),e.screenPresenter&&(e.socket.emit("screen-share-newUser",e.userId,t),console.log("screen-share req sent for new user")),e.connectToUser(e.currentStream,t)}))}},{key:"connectToUser",value:function(e,t){var n=this,s=this.peer.call(t,e,{metadata:{userId:this.userId}});this.peer.on("error",(function(e){console.log("ERROR"+e)})),console.log("made call to "+t+"stream"),s.on("stream",(function(e){console.log("connteced user returned stream"),n.addstream(e,t)})),this.peers[t]=s.peerConnection}},{key:"setPeerListenres",value:function(e){var t=this;console.log("peerlisteners set"),this.peer.on("call",(function(n){n.answer(e),n.on("stream",(function(e){console.log("incoming stream"),t.peers[n.metadata.userId]=n.peerConnection,t.addstream(e,n.metadata.userId)}))}))}},{key:"setlocalstream",value:function(){var e=this;this.getvideoaudio(!0,!0).then((function(t){e.localstream=t,e.currentStream=t,e.addstream(t,e.userId),e.setPeerListenres(e.currentStream),e.newUserConnection()})).catch((function(e){console.log(e.name+": "+e.message)}))}},{key:"getvideoaudio",value:function(e,t){return(navigator.mediaDevices.getUserMedia||navigator.mediaDevices.webkitGetUserMedia||navigator.mediaDevices.mozGetUserMedia||navigator.mediaDevices.msGetUserMedia)({video:e,audio:t})}},{key:"addstream",value:function(e,t){if(!this.videoContainer[t]){var n=document.getElementById("video-grid");this.videoContainer[t]=e;var s=document.createElement("div"),r=document.createElement("video");r.srcObject=e,r.id=t,r.autoplay=!0,this.userId===t&&(r.muted=!0),s.appendChild(r),n.append(s),console.log("done creating video :"+t)}}},{key:"removeuser",value:function(e){this.peers[e]&&this.peers[e].close(),delete this.videoContainer[e];var t=document.getElementById(e);t&&t.remove(),delete this.peers[e]}},{key:"videotoggle",value:function(e){this.localstream&&(this.localstream.getVideoTracks()[0].enabled=!e,this.updatevalue("videoStatus",!e))}},{key:"mictoggle",value:function(e){this.localstream&&(this.localstream.getAudioTracks()[0].enabled=!e,this.updatevalue("micStatus",!e))}},{key:"screenShareView",value:function(e,t){var n=document.getElementById(e);n&&(n.pause(),n.style.display="none");var s=document.getElementById("screen-share");s.style.display="inline",s.srcObject=t,s.autoplay=!0,console.log("video elemnt",s)}},{key:"screenShareRevert",value:function(e){var t=document.getElementById("screen-share");t&&(t.pause(),t.srcObject=null,t.style.display="none");var n=document.getElementById(e);n&&(n.style.display="inline",n.play())}},{key:"screenSharetoggle",value:function(e){var t=this;if(e){if(!this.screenShareStatus)return;navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:{echoCancellation:!0,noiseSuppression:!0}}).then((function(e){if(e.getVideoTracks()[0].onended=function(){t.stopscreen()},e){t.socket.emit("screen-share",t.userId),console.log("screen-share req sent"),t.currentStream=e,t.screenShareStatus=!t.screenShareStatus,t.updatevalue("screenShareStatus",t.screenShareStatus),t.screenPresenter=!t.screenPresenter,t.updatevalue("screenPresenter",t.screenPresenter),t.screenShareView(t.userId,e);for(var n=0,s=Object.entries(t.peers);n<s.length;n++){var r=Object(d.a)(s[n],2);r[0];r[1].getSenders().map((function(t){"video"==t.track.kind&&e.getVideoTracks().length>0&&t.replaceTrack(e.getVideoTracks()[0])}))}}})).catch((function(e){console.log("unable to get screen stream"+e)}))}else this.stopscreen()}},{key:"stopscreen",value:function(){var e=this;if(this.screenPresenter){this.socket.emit("normal-view",this.userId),this.screenPresenter=!this.screenPresenter,this.screenShareStatus=!this.screenShareStatus,this.updatevalue("screenShareStatus",this.screenShareStatus),this.updatevalue("screenPresenter",this.screenPresenter),this.screenShareRevert(this.userId);var t=document.getElementById(this.userId);t&&(t.pause(),t.srcObject=this.localstream,t.play()),this.currentStream=this.localstream;for(var n=0,s=Object.entries(this.peers);n<s.length;n++){var r=Object(d.a)(s[n],2);r[0];r[1].getSenders().map((function(t){"video"==t.track.kind&&e.localstream.getVideoTracks().length>0&&t.replaceTrack(e.localstream.getVideoTracks()[0])}))}}}},{key:"recordScreen",value:function(e){var t=this;e?navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:{echoCancellation:!0,noiseSuppression:!0}}).then((function(e){t.mediaRecorder=new MediaRecorder(e),t.startrecording(),e.getVideoTracks()[0].onended=function(){t.endrecording()}})).catch((function(e){console.log("unable to get screen stream for recording"+e)})):this.endrecording()}},{key:"startrecording",value:function(){var e=this;this.updatevalue("recordStatus",!1),console.log("starting",this.mediaRecorder),this.mediaRecorder.ondataavailable=function(t){console.log("ondataavail",t),t.data.size>0&&e.recordedChunks.push(t.data)},this.mediaRecorder.onstop=function(){var t=new Blob(e.recordedChunks,{type:"video/mp4"});console.log(e.recordedChunks.length);var n=URL.createObjectURL(t),s=document.createElement("a");s.style.display="none",s.href=n;var r=new Date,a=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+"-"+(r.getHours()+":"+r.getMinutes()+":"+r.getSeconds());s.download="Recording/"+a+".mp4",document.body.appendChild(s),s.click(),setTimeout((function(){document.body.removeChild(s),window.URL.revokeObjectURL(n)}),200),e.recordedChunks=[]},this.mediaRecorder.start(1500)}},{key:"endrecording",value:function(){this.mediaRecorder&&(console.log("ending",this.mediaRecorder),this.updatevalue("recordStatus",!0),this.mediaRecorder.stop(),this.mediaRecorder=null)}},{key:"broadcastmessage",value:function(e,t){this.socket&&this.socket.emit("new-message",t,e)}},{key:"exitcall",value:function(e){(this.screenPresenter&&this.socket.emit("normal-view",this.userId),this.socket.emit("userleftchat",e),this.socket.disconnect(),this.videoContainer[this.userId])&&this.videoContainer[this.userId].getTracks().forEach((function(e){e.stop()}));delete this.videoContainer,delete this.peer,delete this.peers}},{key:"newuserChat",value:function(e){var t=this;setTimeout((function(){t.socket&&t.socket.emit("newuserName",e)}),1500)}}]),e}();var I=n(241),E=n(242),N=n(114),R=n.n(N),T=n(115),D=n.n(T),P=n(117),B=n.n(P),U=n(118),M=n.n(U),V=n(116),L=n.n(V),F=n(243),H=n(122),W=n(248),q=n(120),G=n.n(q),J=n(240),A=n(119),_=n.n(A),z=n(65),Y=(n(189),n(190),n(36)),K=(n(191),n(249)),Q=n(124),X=n(250);n(192);function Z(e){var t=Object(s.useState)(!0),n=Object(d.a)(t,2),a=n[0],c=n[1],o=Object(s.useState)({name:""}),i=Object(d.a)(o,2),u=i[0],l=i[1],p=function(t){"keyup"!==t.type&&u.name.length>0&&(e.submitHandle(u),c(!1))};return Object(b.jsx)(r.a.Fragment,{children:Object(b.jsx)(K.a,{disableBackdropClick:!0,className:"user-popup",onClose:function(){return c(!1)},open:a,children:Object(b.jsxs)(Q.a,{className:"user-popup-paper",onKeyUp:p,align:"center",children:[Object(b.jsx)(X.a,{className:"user-popup-title",children:"Enter Your Name"}),Object(b.jsxs)("div",{className:"user-details-wrapper",children:[Object(b.jsx)(m.a,{required:!0,title:"Name",id:"outlined-required",className:"user-popup-input",label:"Name",variant:"outlined",onChange:function(e){var t=e.target.value;l({name:t})},placeholder:"Name"}),Object(b.jsx)(h.a,{className:"user-popup-button",color:"primary",onClick:p,children:"START"})]})]})})})}var $,ee,te=Object(s.memo)(Z),ne=function(e){var t=e.location.pathname.substring(1),n=Object(s.useState)(!0),a=Object(d.a)(n,2),c=a[0],o=a[1],i=Object(s.useState)(!0),u=Object(d.a)(i,2),l=u[0],h=u[1],m=Object(s.useState)(!0),p=Object(d.a)(m,2),v=p[0],j=p[1],g=Object(s.useState)(!0),S=Object(d.a)(g,2),f=S[0],O=S[1],k=Object(s.useState)(!1),x=Object(d.a)(k,2),y=x[0],C=x[1],N=r.a.useState(null),T=Object(d.a)(N,2),P=T[0],U=T[1],V=Boolean(P),q=Object(s.useState)(""),A=Object(d.a)(q,2),K=A[0],Q=A[1];Object(s.useEffect)((function(){$=function(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({roomId:t,micStatus:c,videoStatus:l,recordStatus:v,updatevalue:X}),z.a.configure(),Object(Y.deleteMessages)(),Object(Y.addLinkSnippet)({title:"Share this link with your friends to talk",link:"http://localhost:3000".concat(t),target:""}),ee=0}),[]);var X=function(e,t){"recordStatus"===e?j(t):"micStatus"===e?o(t):"videoStatus"===e?h(t):"screenPresenter"===e?(C(t),h(!t),$.videotoggle(t)):"screenShareStatus"===e?O(t):"Incomingmessage"===e?Z(t):"newuserName"===e&&ne(t)},Z=function(e){Object(Y.renderCustomComponent)(re,e),ee++,console.log("msg count: ".concat(ee)),Object(Y.setBadgeCount)(ee)},ne=function(e){Object(Y.renderCustomComponent)(se,e)},se=function(e){return Object(b.jsxs)(r.a.Fragment,{children:[" ",Object(b.jsx)("div",{class:"chat-messages",children:Object(b.jsxs)("div",{class:"new-user",children:[e.userName," ",e.messageBody]})})]})},re=function(e){return Object(b.jsxs)(r.a.Fragment,{children:[" ",Object(b.jsxs)("div",{class:"chat-messages",children:[Object(b.jsx)("div",{class:"message",children:e.messageBody}),Object(b.jsxs)("div",{class:"from",children:[e.userName," ",(new Date).toLocaleTimeString()]})]})]})};return Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)("div",{onClick:function(){Object(Y.isWidgetOpened)()&&(ee=0)},children:Object(b.jsx)(Y.Widget,{handleNewUserMessage:function(e){$.broadcastmessage(e,K)},title:"Chat here !",subtitle:"",autofocus:!1,showTimeStamp:!1,setBadgeCount:ee})}),Object(b.jsx)(te,{submitHandle:function(e){Q(e.name),console.log("username",e.name),$.newuserChat(e.name)}}),Object(b.jsxs)("div",{id:"video-grid",children:[" ",Object(b.jsx)("video",{id:"screen-share",display:"none"})," "]}),Object(b.jsx)(I.a,{className:"footbar-wrapper",position:"bottom-fixed",color:"primary",children:Object(b.jsxs)(E.a,{className:"footbar-tool",children:[Object(b.jsx)("div",{onClick:function(){$.mictoggle(c)},title:c?"Disable Mic":"Enable Mic",children:c?Object(b.jsx)(R.a,{}):Object(b.jsx)(D.a,{})}),Object(b.jsx)("div",{onClick:function(){$.exitcall(K),e.history.push("/")},children:Object(b.jsx)(L.a,{})}),Object(b.jsx)("div",{onClick:function(){y||$.videotoggle(l)},title:c?"Disable Cam":"Enable Cam",children:l?Object(b.jsx)(B.a,{}):Object(b.jsx)(M.a,{})}),Object(b.jsx)("div",{onClick:function(){!function(){var e=document.createElement("textarea");e.innerText=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}(),z.a.info("Room code copied to clipboard !",{position:z.a.POSITION.TOP_CENTER})},title:"Add user",children:Object(b.jsx)(_.a,{})}),Object(b.jsx)(F.a,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:function(e){U(e.currentTarget)},children:Object(b.jsx)(G.a,{})}),Object(b.jsxs)(H.a,{id:"more",anchorEl:P,keepMounted:!0,open:V,onClose:function(){U(null)},TransitionComponent:J.a,children:[Object(b.jsx)(W.a,{onClick:function(){$.screenSharetoggle(f)},children:y||f?f?"Share Screen":"End ScreenShare":"Disabled"}),Object(b.jsx)(W.a,{onClick:function(){$.recordScreen(v)},children:v?"Start Recording":"Stop Recording"})]})]})})]})},se=function(){return Object(b.jsxs)(o.a,{children:[Object(b.jsx)(i.a,{path:"/",exact:!0,component:S}),Object(b.jsx)(i.a,{path:"/:Room",component:ne})]})};c.a.render(Object(b.jsx)(se,{}),document.getElementById("root"))}},[[195,1,2]]]);
//# sourceMappingURL=main.b7a9c49e.chunk.js.map